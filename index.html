<!DOCTYPE html>
<html lang="zh-TW">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Artale 經驗值時間效率計算機</title>
    <link rel="stylesheet" href="styles.css">
    <script src="https://cdn.jsdelivr.net/npm/chart.js@4.4.1/dist/chart.umd.min.js"></script>
</head>
<body>
    <button id="themeToggle" class="theme-toggle" aria-label="切換主題">
        <span class="theme-icon">☀️</span>
    </button>

    <div class="container">
        <header>
            <button id="historyToggle" class="history-toggle" aria-label="等級記錄">
                <svg class="history-icon" viewBox="0 0 24 24" width="20" height="20" fill="none" stroke="currentColor" stroke-width="2">
                    <polyline points="22 12 18 12 15 21 9 3 6 12 2 12"></polyline>
                </svg>
                <span class="history-text">等級記錄</span>
            </button>
            <h1>楓之谷 Artale</h1>
            <h2>經驗值時間效率計算機</h2>
        </header>

        <!-- History Chart Panel -->
        <div id="historyPanel" class="history-panel hidden">
            <div class="history-header">
                <h3>等級記錄歷史</h3>
                <button id="closeHistory" class="close-history" aria-label="關閉">&times;</button>
            </div>
            <div class="chart-container">
                <canvas id="historyChart"></canvas>
            </div>
            <div class="history-footer">
                <button id="clearHistory" class="btn-clear-history" aria-label="清空記錄">
                    <svg class="trash-icon" viewBox="0 0 24 24" width="16" height="16" fill="none" stroke="currentColor" stroke-width="2">
                        <polyline points="3 6 5 6 21 6"></polyline>
                        <path d="M19 6v14a2 2 0 0 1-2 2H7a2 2 0 0 1-2-2V6m3 0V4a2 2 0 0 1 2-2h4a2 2 0 0 1 2 2v2"></path>
                        <line x1="10" y1="11" x2="10" y2="17"></line>
                        <line x1="14" y1="11" x2="14" y2="17"></line>
                    </svg>
                    清空記錄
                </button>
                <div class="history-info">
                    <p>已記錄 <span id="recordCount">0</span> 筆資料</p>
                </div>
            </div>
        </div>

        <main>
            <form id="calcForm" class="calc-form">
                <!-- Mode Selection -->
                <div class="mode-selection">
                    <button type="button" id="modeSimple" class="mode-btn active">簡單模式</button>
                    <button type="button" id="modeAdvanced" class="mode-btn">進階模式</button>
                </div>

                <!-- Current Level and EXP in one line with record button -->
                <div class="current-status-group">
                    <div class="form-group-inline">
                        <label for="currentLevel">現在等級</label>
                        <input
                            type="number"
                            id="currentLevel"
                            min="1"
                            max="200"
                            required
                            placeholder="輸入現在等級"
                        >
                    </div>

                    <div class="form-group-inline">
                        <label for="currentExp">現在EXP</label>
                        <input
                            type="number"
                            id="currentExp"
                            min="0"
                            required
                            placeholder="輸入現在經驗值"
                        >
                    </div>

                    <button type="button" id="recordBtn" class="btn-record" aria-label="記錄">記錄</button>
                </div>

                <div class="form-group">
                    <label for="targetLevel">目標等級</label>
                    <input
                        type="number"
                        id="targetLevel"
                        min="1"
                        max="200"
                        required
                        placeholder="輸入目標等級"
                    >
                </div>

                <div class="form-group">
                    <label for="expEfficiency">現在每10分鐘經驗效率</label>
                    <div class="exp-unit-toggle">
                        <button type="button" id="unitMan" class="unit-btn active">單位:萬</button>
                        <button type="button" id="unitRegular" class="unit-btn">單位:1</button>
                    </div>
                    <input
                        type="number"
                        id="expEfficiency"
                        min="0"
                        step="0.1"
                        required
                        placeholder="輸入每10分鐘獲得的經驗值"
                    >
                </div>

                <!-- Advanced Options -->
                <div id="advancedOptions" class="advanced-options hidden">
                    <div class="advanced-options-header">
                        <h3>進階選項</h3>
                    </div>

                    <div id="advancedContent" class="advanced-content">
                        <!-- Area 1: Always-on multipliers -->
                        <div class="advanced-section">
                            <h4>常駐經驗加成</h4>

                            <div class="radio-group">
                                <label>
                                    <input type="radio" name="holySymbol" value="none" checked>
                                    無 (0%)
                                </label>
                                <label>
                                    <input type="radio" name="holySymbol" value="alive">
                                    活7 (+50%)
                                </label>
                                <label>
                                    <input type="radio" name="holySymbol" value="dead">
                                    死7 (+25%)
                                </label>
                            </div>

                            <label class="checkbox-label">
                                <input type="checkbox" id="tauntBuff">
                                挑釁 (+30%)
                            </label>
                        </div>

                        <!-- Area 2: EXP Events -->
                        <div class="advanced-section">
                            <h4>限時經驗活動</h4>

                            <!-- EXP Coupon -->
                            <div class="event-group">
                                <label class="checkbox-label">
                                    <input type="checkbox" id="expCoupon">
                                    經驗加倍券
                                </label>
                                <div id="couponOptions" class="event-options hidden">
                                    <div class="radio-group-inline">
                                        <label>
                                            <input type="radio" name="couponType" value="2x" checked>
                                            2x (+100%)
                                        </label>
                                        <label>
                                            <input type="radio" name="couponType" value="3x">
                                            3x (+200%)
                                        </label>
                                    </div>
                                    <label class="input-label">
                                        剩餘幾張:
                                        <input type="number" id="couponCount" value="0" class="small-input">
                                        (加倍券1張=30分鐘)
                                    </label>
                                </div>
                            </div>

                            <!-- Weather Event -->
                            <div class="event-group">
                                <label class="checkbox-label">
                                    <input type="checkbox" id="weatherEvent">
                                    每日氣場15次
                                </label>
                                <div id="weatherOptions" class="event-options hidden">
                                    <div class="radio-group-inline">
                                        <label>
                                            <input type="radio" name="weatherType" value="2x" checked>
                                            2x (+100%)
                                        </label>
                                        <label>
                                            <input type="radio" name="weatherType" value="3x">
                                            3x (+200%)
                                        </label>
                                    </div>
                                    <label class="input-label">
                                        剩餘次數:
                                        <input type="number" id="weatherTimes" min="0" value="0" class="small-input">
                                        (每次2x15=30分鐘)
                                    </label>
                                </div>
                            </div>
                        </div>

                        <!-- Area 3: Grinding Schedule -->
                        <div class="advanced-section">
                            <h4>練功排程</h4>

                            <div class="radio-group">
                                <label>
                                    <input type="radio" name="scheduleMode" value="daily" checked>
                                    每日練功
                                </label>
                                <label>
                                    <input type="radio" name="scheduleMode" value="target">
                                    目標天數
                                </label>
                            </div>

                            <div id="scheduleInputs" class="schedule-inputs">
                                <!-- Daily grinding option -->
                                <div id="dailyGrindingInput" class="schedule-option">
                                    <label class="input-label">每日練功時間:</label>
                                    <div class="time-unit-toggle">
                                        <button type="button" id="unitHour" class="unit-btn-small active">小時</button>
                                        <button type="button" id="unitMinute" class="unit-btn-small">分鐘</button>
                                    </div>
                                    <input type="number" id="dailyTime" min="0" step="0.1" value="0" class="small-input">
                                    <span class="input-hint">(輸入0代表不計算)</span>
                                </div>

                                <!-- Target days option -->
                                <div id="targetDaysInput" class="schedule-option hidden">
                                    <label class="input-label">
                                        目標天數:
                                        <input type="number" id="targetDays" min="0" value="0" class="small-input">
                                        天
                                        <span class="input-hint">(輸入0代表不計算)</span>
                                    </label>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>

                <button type="submit" class="btn-calculate">計算</button>
            </form>

            <div id="results" class="results hidden">
                <h3>計算結果</h3>
                <div class="result-item">
                    <span class="result-label">起始等級:</span>
                    <span id="startLevel" class="result-value">0</span>
                </div>
                <div class="result-item">
                    <span class="result-label">目標等級:</span>
                    <span id="endLevel" class="result-value">0</span>
                </div>
                <div class="result-item">
                    <span class="result-label">所需總經驗值:</span>
                    <span id="totalExp" class="result-value">0</span>
                </div>
                <div class="result-item">
                    <span class="result-label">常駐經驗加成:</span>
                    <span id="regularBonus" class="result-value">0</span>
                </div>
                <div class="result-item">
                    <span class="result-label">預計所需時間:</span>
                    <span id="timeNeeded" class="result-value">0</span>
                </div>
                <div id="eventTimeBreakdown" class="event-breakdown hidden">
                    <!-- Dynamic event phase breakdown will be inserted here -->
                </div>
                <div id="scheduleResult" class="result-item hidden">
                    <span class="result-label" id="scheduleLabel">練功排程:</span>
                    <span id="scheduleValue" class="result-value">0</span>
                </div>
            </div>
        </main>

        <footer>
            <p>楓之谷 Artale 經驗值計算工具 by isaswa</p>
            <div class="social-links">
                <span class="social-label">聯絡開發者</span>
                <a href="https://github.com/isaswa" target="_blank" rel="noopener noreferrer" class="social-link" aria-label="GitHub">
                    <svg viewBox="0 0 16 16" width="20" height="20" fill="currentColor">
                        <path d="M8 0C3.58 0 0 3.58 0 8c0 3.54 2.29 6.53 5.47 7.59.4.07.55-.17.55-.38 0-.19-.01-.82-.01-1.49-2.01.37-2.53-.49-2.69-.94-.09-.23-.48-.94-.82-1.13-.28-.15-.68-.52-.01-.53.63-.01 1.08.58 1.23.82.72 1.21 1.87.87 2.33.66.07-.52.28-.87.51-1.07-1.78-.2-3.64-.89-3.64-3.95 0-.87.31-1.59.82-2.15-.08-.2-.36-1.02.08-2.12 0 0 .67-.21 2.2.82.64-.18 1.32-.27 2-.27.68 0 1.36.09 2 .27 1.53-1.04 2.2-.82 2.2-.82.44 1.1.16 1.92.08 2.12.51.56.82 1.27.82 2.15 0 3.07-1.87 3.75-3.65 3.95.29.25.54.73.54 1.48 0 1.07-.01 1.93-.01 2.2 0 .21.15.46.55.38A8.013 8.013 0 0016 8c0-4.42-3.58-8-8-8z"></path>
                    </svg>
                </a>
                <a href="discord://discordapp.com/users/310834934753525761" class="social-link" aria-label="Discord - isaswa">
                    <svg viewBox="0 0 16 16" width="20" height="20" fill="currentColor">
                        <path d="M13.545 2.907a13.227 13.227 0 0 0-3.257-1.011.05.05 0 0 0-.052.025c-.141.25-.297.577-.406.833a12.19 12.19 0 0 0-3.658 0 8.258 8.258 0 0 0-.412-.833.051.051 0 0 0-.052-.025c-1.125.194-2.22.534-3.257 1.011a.041.041 0 0 0-.021.018C.356 6.024-.213 9.047.066 12.032c.001.014.01.028.021.037a13.276 13.276 0 0 0 3.995 2.02.05.05 0 0 0 .056-.019c.308-.42.582-.863.818-1.329a.05.05 0 0 0-.01-.059.051.051 0 0 0-.018-.011 8.875 8.875 0 0 1-1.248-.595.05.05 0 0 1-.02-.066.051.051 0 0 1 .015-.019c.084-.063.168-.129.248-.195a.05.05 0 0 1 .051-.007c2.619 1.196 5.454 1.196 8.041 0a.052.052 0 0 1 .053.007c.08.066.164.132.248.195a.051.051 0 0 1-.004.085 8.254 8.254 0 0 1-1.249.594.05.05 0 0 0-.03.03.052.052 0 0 0 .003.041c.24.465.515.909.817 1.329a.05.05 0 0 0 .056.019 13.235 13.235 0 0 0 4.001-2.02.049.049 0 0 0 .021-.037c.334-3.451-.559-6.449-2.366-9.106a.034.034 0 0 0-.02-.019Zm-8.198 7.307c-.789 0-1.438-.724-1.438-1.612 0-.889.637-1.613 1.438-1.613.807 0 1.45.73 1.438 1.613 0 .888-.637 1.612-1.438 1.612Zm5.316 0c-.788 0-1.438-.724-1.438-1.612 0-.889.637-1.613 1.438-1.613.807 0 1.451.73 1.438 1.613 0 .888-.631 1.612-1.438 1.612Z"></path>
                    </svg>
                </a>
            </div>
        </footer>
    </div>

    <script src="const.js"></script>
    <script src="script.js"></script>
</body>
</html>
